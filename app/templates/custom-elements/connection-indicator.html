<template id="connection-indicator-template">
  <style>
    .status {
      display: flex;
      flex-direction: row;
      align-items: center;
    }

    content-tooltip {
      display: flex;
      flex-direction: row;
      align-items: center;
    }

    .status-dot {
      height: 1rem;
      width: 1rem;
      margin: 0 0.5rem 0.2rem 0;
      border-radius: 50%;
      display: inline-block;
      /* Disconnected state */
      background-color: var(--brand-red-bright);
    }

    :host([connected="true"]) .status-dot {
      background-color: var(--brand-green-bright);
    }

    .connected-text {
      display: none;
    }

    :host([connected="true"]) .connected-text {
      display: block;
    }

    .disconnected-text {
      display: block;
    }

    :host([connected="true"]) .disconnected-text {
      display: none;
    }
  </style>
  <div class="status">
    <content-tooltip position="top-right">
      <span class="status-dot"></span>
      <div slot="text" class="connected-text">
        You are connected to TinyPilot.
      </div>
      <div slot="text" class="disconnected-text">
        Could not connect to TinyPilot:
        <span id="disconnect-reason"></span>
      </div>
    </content-tooltip>
    <div id="label"><!-- Set via JavaScript --></div>
  </div>
</template>

<script>
  (function () {
    const doc = (document._currentScript || document.currentScript)
      .ownerDocument;
    const template = doc.querySelector("#connection-indicator-template");

    customElements.define(
      "connection-indicator",
      class extends HTMLElement {
        connectedCallback() {
          this.attachShadow({ mode: "open" });
          this.shadowRoot.appendChild(template.content.cloneNode(true));
          this.label = this.shadowRoot.getElementById("label");
          this.connected = false;
        }

        get connected() {
          return this.getAttribute("connected");
        }

        set connected(isConnected) {
          this.setAttribute("connected", isConnected);
          if (isConnected) {
            this.label.innerText = "Connected";
          } else {
            this.label.innerText = "Disconnected";
          }
        }

        get disconnectReason() {
          return this.shadowRoot.querySelector("#disconnect-reason")
            .textContent;
        }

        set disconnectReason(newValue) {
          this.shadowRoot.querySelector(
            "#disconnect-reason"
          ).innerText = newValue;
        }
      }
    );
  })();
</script>
